[æ ¹ç›®å½•](../../CLAUDE.md) > **bash-permission-hook**

# Bash Permission Hook æ¨¡å—

> ğŸ  [è¿”å›é¡¹ç›®æ ¹ç›®å½•](../../CLAUDE.md)

## æ¨¡å—æ¦‚è¿°

Bash Permission Hook æ˜¯ Claude Code æƒé™é’©å­æ’ä»¶çš„æ ¸å¿ƒå®ç°æ¨¡å—ï¼Œè´Ÿè´£æ‹¦æˆªå±é™©çš„ Bash å‘½ä»¤å¹¶æ¨èä½¿ç”¨å†…ç½®å·¥å…·ã€‚

## æ¥å£å®šä¹‰

### ä¸»å…¥å£ç‚¹
```javascript
// scripts/check-command.js
handleHook(input) â†’ { decision: "approve" | "block", reason?: string }
```

**è¾“å…¥æ ¼å¼**:
```json
{
  "tool_input": {
    "command": "å®Œæ•´çš„ Bash å‘½ä»¤"
  }
}
```

**è¾“å‡ºæ ¼å¼**:
```json
{
  "decision": "block",
  "reason": "âš ï¸ grepå‘½ä»¤è¢«æ‹¦æˆªï¼Œä½¿ç”¨å†…ç½®çš„Grepå·¥å…·ä»£æ›¿"
}
```

## æ ¸å¿ƒä¾èµ–

### å†…éƒ¨ä¾èµ–
- **é…ç½®ç³»ç»Ÿ**: `config/config.json` - æ‹¦æˆªè§„åˆ™å®šä¹‰
- **Node.js å†…ç½®æ¨¡å—**: `fs`, `path`

### å¤–éƒ¨ä¾èµ–
- **Node.js Runtime**: >= 14.0.0
- **Claude Code Hook API**: é€šè¿‡æ ‡å‡†è¾“å…¥ä¼ é€’å‚æ•°

## æ¨¡å—å…¥å£

### ä¸»è¦å‡½æ•°

#### `handleHook(input)`
ä¸»å¤„ç†å‡½æ•°ï¼Œæ¥æ”¶ Claude Code ä¼ å…¥çš„å‘½ä»¤å‚æ•°

#### `loadRules()`
ä»é…ç½®æ–‡ä»¶åŠ è½½æ‹¦æˆªè§„åˆ™

#### `splitCommandsWithSplits(command)`
æ‰©å±•çš„å‘½ä»¤æ‹†åˆ†å‡½æ•°ï¼Œæ”¯æŒæ“ä½œç¬¦ä½ç½®æ£€æµ‹

#### `isInPipeReceiver()`
æ£€æŸ¥å‘½ä»¤æ˜¯å¦ä½œä¸ºç®¡é“æ¥æ”¶ç«¯

#### `checkCommand(cmd, rules, options)`
åŸºäºè§„åˆ™æ£€ç´¢å•ä¸ªå‘½ä»¤æ˜¯å¦è¢«æ‹¦æˆª

## å…³é”®æ–‡ä»¶

### ğŸ¯ `scripts/check-command.js`
**æ ¸å¿ƒé€»è¾‘æ–‡ä»¶** - åŒ…å«æ‰€æœ‰å‘½ä»¤å¤„ç†é€»è¾‘

### âš™ï¸ `config/config.json`
**é…ç½®æ–‡ä»¶** - å®šä¹‰æ‹¦æˆªè§„åˆ™å’Œæç¤ºä¿¡æ¯

### ğŸ£ `hooks/hooks.json`
**é’©å­é…ç½®** - Claude Code é’©å­æ³¨å†Œä¿¡æ¯

## é…ç½®è¯´æ˜

### è§„åˆ™ç»“æ„
```json
{
  "pattern": "grep",
  "action": "reject",
  "suggestion": "ä½¿ç”¨å†…ç½®çš„Grepå·¥å…·ä»£æ›¿",
  "allowInPipeReceiver": true
}
```

**æ–°å¢å­—æ®µè¯´æ˜**ï¼š
- **`allowInPipeReceiver`**: Booleanç±»å‹ï¼Œå¯é€‰å­—æ®µã€‚è®¾ç½®ä¸º `true` æ—¶ï¼Œå‘½ä»¤åœ¨ç®¡é“æ¥æ”¶ç«¯ä½ç½®å°†è¢«æ”¾è¡Œï¼Œä¾¿äºä¸å…¶ä»–å‘½ä»¤é…åˆè¿›è¡Œæ•°æ®å¤„ç†ã€‚

### æ”¯æŒçš„å‘½ä»¤ç±»å‹
- **å•å‘½ä»¤**: `grep`, `find`, `cat`
- **å¤šè¯å‘½ä»¤**: `npm install`, `git push`
- **è·¯å¾„å‰ç¼€**: è‡ªåŠ¨å‰¥ç¦» `/usr/bin/grep` â†’ `grep`

## æ™ºèƒ½ç‰¹æ€§

### ğŸ“ ç®¡é“ä½ç½®æ£€æµ‹
- **è¯†åˆ«é€»è¾‘**: åŸºäºæ“ä½œç¬¦ä½ç½®å’Œå‘½ä»¤ç´¢å¼•
- **é…ç½®åŒ–å¤„ç†**: æ”¯æŒ `allowInPipeReceiver` é…ç½®å­—æ®µï¼Œå¯é…ç½®å‘½ä»¤åœ¨ç®¡é“æ¥æ”¶ç«¯ä½ç½®æ—¶æ”¾è¡Œ
- **å½“å‰å®ç°**: `grep` å’Œ `head` å‘½ä»¤åœ¨ç®¡é“æ¥æ”¶ç«¯ä½ç½®è‡ªåŠ¨æ”¾è¡Œ
- **å®‰å…¨ä¿è¯**: å…¶ä»–ä½ç½®ä»ä¸¥æ ¼æ‰§è¡Œæ‹¦æˆª

### ğŸ”§ å¯æ‰©å±•æ¶æ„
- **è§„åˆ™é©±åŠ¨**: æ–°å¢å‘½ä»¤æ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç 
- **é”™è¯¯å®¹é”™**: é…ç½®åŠ è½½å¤±è´¥æ—¶é»˜è®¤æ”¾è¡Œ
- **æ€§èƒ½ä¼˜åŒ–**: å‘½ä»¤æ‹†åˆ†ç»“æœç¼“å­˜

## éƒ¨ç½²æ³¨æ„

### åŒæ­¥è¦æ±‚
âš ï¸ **ä¿®æ”¹ä»£ç åå¿…é¡»åŒæ­¥åˆ°å®é™…æ’ä»¶è¿è¡Œç›®å½•**

è¿è¡Œç›®å½•æ ¼å¼ï¼š
```
~/.claude/plugins/cache/claude-code-permissions-hook/bash-permission-hook/1.1.0/
```

### æ‰‹åŠ¨æµ‹è¯•
æµ‹è¯•å…¸å‹åœºæ™¯ï¼Œåœ¨ Claude Code çœŸå®ç¯å¢ƒä¸­éªŒè¯ï¼š
- `grep` å‘½ä»¤æ‹¦æˆªåŠŸèƒ½
- `head` å‘½ä»¤åœ¨ç®¡é“ä¸­çš„è¡¨ç°
- æ¨èæ›¿ä»£æ–¹æ¡ˆæç¤ºä¿¡æ¯æ˜¯å¦å‡†ç¡®

### éƒ¨ç½²è„šæœ¬ä½ç½®
- **åŠŸèƒ½**ï¼šè‡ªåŠ¨è¯»å–ç‰ˆæœ¬å·ã€åŒæ­¥æ–‡ä»¶

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°æ‹¦æˆªè§„åˆ™
1. åœ¨ `config/config.json` ä¸­æ·»åŠ è§„åˆ™é…ç½®
2. åœ¨ Claude Code ç¯å¢ƒä¸­éªŒè¯ç‰¹æ®Šåœºæ™¯ï¼ˆå¦‚ç®¡é“ä½ç½®ï¼‰
3. æ›´æ–°éƒ¨ç½²æ–‡æ¡£ï¼ˆå¦‚éœ€è¦ï¼‰

### è°ƒè¯•æŠ€å·§
```javascript
// å¯ç”¨è¯¦ç»†æ—¥å¿—
console.log('å‘½ä»¤æ‹†åˆ†ç»“æœ:', splitCommands, splits);
console.log('ç®¡é“ä½ç½®æ£€æµ‹:', isPipeReceiver);
```

## æ¨¡å—è¾¹ç•Œ

- **è¾“å…¥**: ä»…å¤„ç†æ ‡å‡† JSON æ ¼å¼çš„å‘½ä»¤è¾“å…¥
- **è¾“å‡º**: ç»Ÿä¸€çš„å†³ç­–å“åº”æ ¼å¼
- **èŒè´£**: ä¸“æ³¨å‘½ä»¤æ‹¦æˆªï¼Œä¸æ¶‰åŠå®é™…æ‰§è¡Œ
- **ä¾èµ–**: æœ€å°åŒ–å¤–éƒ¨ä¾èµ–ï¼Œç¡®ä¿è½»é‡çº§è¿è¡Œ

## ç‰ˆæœ¬ä¿¡æ¯

- **å½“å‰ç‰ˆæœ¬**: 1.2.0
- **å…¼å®¹æ€§**: Node.js >= 14.0.0
- **æœ€åæ›´æ–°**: 2025-12-23

## ğŸ“‹ å˜æ›´è®°å½• (Changelog)

### 2025-12-23 15:34:56
- ğŸ§­ æ·»åŠ å¯¼èˆªé¢åŒ…å±‘
- ğŸ“Š æ›´æ–°æ¨¡å—çŠ¶æ€ä¸ºç”Ÿäº§å°±ç»ª
- ğŸ”— å®Œå–„ä¸æ ¹ç›®å½•æ–‡æ¡£çš„é“¾æ¥

### 2025-12-19
- âœ¨ åˆå§‹ç‰ˆæœ¬åˆ›å»º
- ğŸ—ï¸ å»ºç«‹æ ¸å¿ƒæ‹¦æˆªé€»è¾‘
- ğŸ“š å®Œå–„æ–‡æ¡£ä½“ç³»

---

> ğŸ  [è¿”å›é¡¹ç›®æ ¹ç›®å½•](../../CLAUDE.md) | ğŸ“„ [Web æ¨¡å—æ–‡æ¡£](../web-permission-hook/CLAUDE.md) | ğŸªŸ [Win Path æ¨¡å—æ–‡æ¡£](../win-path-check-hook/CLAUDE.md)