# Web Permission Hook æ¨¡å—

> ğŸ  [è¿”å›é¡¹ç›®æ ¹ç›®å½•](../CLAUDE.md)

## æ¨¡å—æ¦‚è¿°

Web Permission Hook æ˜¯ Claude Code Web å·¥å…·æƒé™æ§åˆ¶çš„æ ¸å¿ƒå®ç°æ¨¡å—ï¼Œè´Ÿè´£æ‹¦æˆª WebFetch å’Œ WebSearch å·¥å…·è°ƒç”¨ï¼Œå¹¶å¼•å¯¼ç”¨æˆ·ä½¿ç”¨æ›´å®‰å…¨çš„ MCP (Model Context Protocol) æœåŠ¡ã€‚

## æ¥å£å®šä¹‰

### ä¸»å…¥å£ç‚¹
```javascript
// scripts/check-command.js
handleHook(input) â†’ { decision: "approve" | "block", reason?: string }
```

**è¾“å…¥æ ¼å¼**:
```json
{
  "tool_name": "WebFetch" | "WebSearch",
  "tool_input": {
    // å·¥å…·ç‰¹å®šå‚æ•°
  }
}
```

**è¾“å‡ºæ ¼å¼**:
```json
{
  "decision": "block",
  "reason": "âš ï¸ WebFetch å·¥å…·è¢«æ‹¦æˆªï¼Œä½¿ç”¨ Fetch MCP æ¥ä»£æ›¿"
}
```

## æ ¸å¿ƒä¾èµ–

### å†…éƒ¨ä¾èµ–
- **é…ç½®ç³»ç»Ÿ**: `config/config.json` - å·¥å…·æ˜ å°„è§„åˆ™å®šä¹‰
- **Node.js å†…ç½®æ¨¡å—**: `fs`, `path`

### å¤–éƒ¨ä¾èµ–
- **Node.js Runtime**: >= 14.0.0
- **Claude Code Hook API**: é€šè¿‡æ ‡å‡†è¾“å…¥ä¼ é€’å‚æ•°
- **MCP æœåŠ¡ç”Ÿæ€**: Fetch MCP, Search MCP (æ¨èæ›¿ä»£)

## æ¨¡å—å…¥å£

### ä¸»è¦å‡½æ•°

#### `handleHook(input)`
ä¸»å¤„ç†å‡½æ•°ï¼Œæ¥æ”¶ Claude Code ä¼ å…¥çš„å·¥å…·è°ƒç”¨å‚æ•°

#### `loadToolMappings()`
ä»é…ç½®æ–‡ä»¶åŠ è½½å·¥å…·æ˜ å°„è§„åˆ™

#### `checkToolReplacement(toolName, mappings)`
æ£€æŸ¥å·¥å…·æ˜¯å¦éœ€è¦æ›¿æ¢ï¼Œè¿”å›å†³ç­–å’Œå»ºè®®

## æµ‹è¯•ç³»ç»Ÿ

### æµ‹è¯•æ–‡ä»¶
- `tests/test.js` - Web å·¥å…·æ‹¦æˆªåŠŸèƒ½æµ‹è¯•å¥—ä»¶

### è¿è¡Œæµ‹è¯•
```bash
# ç›´æ¥æ‰§è¡Œæµ‹è¯•
node tests/test.js

# æ‰‹åŠ¨æµ‹è¯•åŠŸèƒ½
echo '{"tool_name": "WebFetch"}' | node scripts/check-command.js
```

### æµ‹è¯•è¦†ç›–
- âœ… WebFetch å·¥å…·æ‹¦æˆª
- âœ… WebSearch å·¥å…·æ‹¦æˆª
- âœ… å·¥å…·æ˜ å°„é…ç½®åŠ è½½
- âœ… é”™è¯¯å¤„ç†å’Œé»˜è®¤æ”¾è¡Œ
- âœ… éç›®æ ‡å·¥å…·æ”¾è¡ŒéªŒè¯

## å…³é”®æ–‡ä»¶

### ğŸ¯ `scripts/check-command.js`
**æ ¸å¿ƒé€»è¾‘æ–‡ä»¶** - åŒ…å«æ‰€æœ‰ Web å·¥å…·å¤„ç†é€»è¾‘

### âš™ï¸ `config/config.json`
**é…ç½®æ–‡ä»¶** - å®šä¹‰å·¥å…·æ˜ å°„è§„åˆ™å’Œæ›¿ä»£å»ºè®®

### ğŸ§ª `tests/test.js`
**æµ‹è¯•æ–‡ä»¶** - è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹

### ğŸ£ `hooks/hooks.json`
**é’©å­é…ç½®** - Claude Code Web å·¥å…·é’©å­æ³¨å†Œ

### ğŸ”Œ `.claude-plugin/plugin.json`
**æ’ä»¶å…ƒæ•°æ®** - Web æ’ä»¶æ³¨å†Œä¿¡æ¯

## é…ç½®è¯´æ˜

### å·¥å…·æ˜ å°„ç»“æ„
```json
{
  "toolMappings": {
    "WebFetch": "ä½¿ç”¨ Fetch MCP æ¥ä»£æ›¿",
    "WebSearch": "ä½¿ç”¨ Search MCP æ¥ä»£æ›¿"
  }
}
```

### æ”¯æŒçš„å·¥å…·ç±»å‹
- **WebFetch**: ç½‘ç»œé¡µé¢è·å–å·¥å…· â†’ Fetch MCP æœåŠ¡
- **WebSearch**: ç½‘ç»œæœç´¢å·¥å…· â†’ Search MCP æœåŠ¡
- **å…¶ä»–å·¥å…·**: é»˜è®¤æ”¾è¡Œï¼Œé™¤éåœ¨æ˜ å°„ä¸­æ˜ç¡®å®šä¹‰

## MCP ç”Ÿæ€é›†æˆ

### æ¨èçš„ MCP æœåŠ¡

#### ğŸ”Œ Fetch MCP
- **åŠŸèƒ½**: å¼ºå¤§çš„ç½‘ç»œé¡µé¢è·å–å’Œå†…å®¹å¤„ç†
- **ä¼˜åŠ¿**: æ›´å¥½çš„é”™è¯¯å¤„ç†ã€å†…å®¹è§£æã€å®‰å…¨æ§åˆ¶
- **æ›¿ä»£åœºæ™¯**: æ‰€æœ‰ WebFetch ä½¿ç”¨åœºæ™¯

#### ğŸ”Œ Search MCP
- **åŠŸèƒ½**: ä¸“ä¸šçš„ç½‘ç»œæœç´¢æœåŠ¡
- **ä¼˜åŠ¿**: å¤šæœç´¢å¼•æ“é›†æˆã€ç»“æœè¿‡æ»¤ã€è¯­ä¹‰æœç´¢
- **æ›¿ä»£åœºæ™¯**: æ‰€æœ‰ WebSearch ä½¿ç”¨åœºæ™¯

### é›†æˆä¼˜åŠ¿
- **æ›´å®‰å…¨**: MCP æœåŠ¡æä¾›æ›´å¥½çš„å®‰å…¨è¾¹ç•Œ
- **æ›´å¼ºå¤§**: åŠŸèƒ½æ¯”åŸç”Ÿå·¥å…·æ›´ä¸°å¯Œ
- **å¯æ‰©å±•**: æ”¯æŒæ’ä»¶åŒ–å’Œè‡ªå®šä¹‰æ‰©å±•
- **æ ‡å‡†åŒ–**: éµå¾ª MCP æ ‡å‡†åè®®

## æ™ºèƒ½ç‰¹æ€§

### ğŸ¯ ç²¾å‡†å·¥å…·è¯†åˆ«
- **åç§°åŒ¹é…**: åŸºäº `tool_name` å­—æ®µç²¾ç¡®è¯†åˆ«
- **ç±»å‹åŒºåˆ†**: åªé’ˆå¯¹ Web ç›¸å…³å·¥å…·è¿›è¡Œæ‹¦æˆª
- **ä¾‹å¤–å¤„ç†**: éç›®æ ‡å·¥å…·è‡ªåŠ¨æ”¾è¡Œ

### ğŸ”§ çµæ´»é…ç½®ç³»ç»Ÿ
- **è§„åˆ™é©±åŠ¨**: é€šè¿‡ JSON é…ç½®è½»æ¾æ‰©å±•å·¥å…·æ˜ å°„
- **é”™è¯¯å®¹é”™**: é…ç½®åŠ è½½å¤±è´¥æ—¶é»˜è®¤æ”¾è¡Œ
- **å®æ—¶ç”Ÿæ•ˆ**: é…ç½®ä¿®æ”¹æ— éœ€é‡å¯å³å¯ç”Ÿæ•ˆ

## éƒ¨ç½²æ³¨æ„

### åŒæ­¥è¦æ±‚
âš ï¸ **ä¿®æ”¹ä»£ç åå¿…é¡»åŒæ­¥åˆ°å®é™…æ’ä»¶è¿è¡Œç›®å½•**

è¿è¡Œç›®å½•æ ¼å¼ï¼š
```
~/.claude/plugins/cache/claude-code-permissions-hook/web-permission-hook/1.0.0/
```

### éªŒè¯æ­¥éª¤
1. å¤åˆ¶ä¿®æ”¹æ–‡ä»¶åˆ°è¿è¡Œç›®å½•
2. æ‰§è¡Œæµ‹è¯•å¥—ä»¶éªŒè¯åŠŸèƒ½
3. æ‰‹åŠ¨æµ‹è¯• WebFetch å’Œ WebSearch æ‹¦æˆª
4. ç¡®è®¤ MCP æ›¿ä»£å»ºè®®æ­£ç¡®æ˜¾ç¤º

### éƒ¨ç½²éªŒè¯
```bash
# æµ‹è¯• WebFetch æ‹¦æˆª
echo '{"tool_name": "WebFetch"}' | node scripts/check-command.js
# é¢„æœŸ: {"decision":"block","reason":"âš ï¸ WebFetch å·¥å…·è¢«æ‹¦æˆªï¼Œä½¿ç”¨ Fetch MCP æ¥ä»£æ›¿"}

# æµ‹è¯•éç›®æ ‡å·¥å…·æ”¾è¡Œ
echo '{"tool_name": "Read"}' | node scripts/check-command.js
# é¢„æœŸ: {"decision":"approve"}
```

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°å·¥å…·æ˜ å°„
1. åœ¨ `config/config.json` ä¸­æ·»åŠ æ–°çš„å·¥å…·æ˜ å°„
2. åœ¨ `tests/test.js` ä¸­æ·»åŠ å¯¹åº”æµ‹è¯•ç”¨ä¾‹
3. éªŒè¯æ‹¦æˆªæç¤ºä¿¡æ¯çš„å‡†ç¡®æ€§
4. æ›´æ–°æ–‡æ¡£ï¼ˆå¦‚éœ€è¦ï¼‰

### è°ƒè¯•æŠ€å·§
```javascript
// å¯ç”¨è¯¦ç»†æ—¥å¿—
console.log('å·¥å…·åç§°:', toolName);
console.log('æ˜ å°„ç»“æœ:', mappings[toolName]);
console.log('å†³ç­–è¾“å‡º:', result);
```

## æ¨¡å—è¾¹ç•Œ

- **è¾“å…¥**: ä»…å¤„ç† Claude Code å·¥å…·è°ƒç”¨æ ‡å‡†æ ¼å¼
- **è¾“å‡º**: ç»Ÿä¸€çš„å†³ç­–å“åº”æ ¼å¼
- **èŒè´£**: ä¸“æ³¨ Web å·¥å…·æ‹¦æˆªï¼Œä¸æ¶‰åŠå®é™…ç½‘ç»œè¯·æ±‚
- **ä¾èµ–**: æœ€å°åŒ–å¤–éƒ¨ä¾èµ–ï¼Œç¡®ä¿è½»é‡çº§è¿è¡Œ
- **èŒƒå›´**: ä¸å¤„ç† Bash å‘½ä»¤æˆ–å…¶ä»–ç±»å‹å·¥å…·

## ä¸ Bash æ¨¡å—åä½œ

- **èŒè´£åˆ†ç¦»**: Bash æ¨¡å—å¤„ç†ç³»ç»Ÿå‘½ä»¤ï¼ŒWeb æ¨¡å—å¤„ç†ç½‘ç»œå·¥å…·
- **é…ç½®ç‹¬ç«‹**: å„è‡ªç»´æŠ¤ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶å’Œè§„åˆ™
- **éƒ¨ç½²åŒæ­¥**: ä¿®æ”¹åéƒ½éœ€è¦åŒæ­¥åˆ°ç›¸åº”è¿è¡Œç›®å½•
- **æµ‹è¯•éš”ç¦»**: å„è‡ªç‹¬ç«‹çš„æµ‹è¯•å¥—ä»¶å’ŒéªŒè¯æµç¨‹

## ç‰ˆæœ¬ä¿¡æ¯

- **å½“å‰ç‰ˆæœ¬**: 1.0.0
- **å…¼å®¹æ€§**: Node.js >= 14.0.0
- **æœ€åæ›´æ–°**: 2025-12-22
- **é¡¹ç›®çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

---

> ğŸ  [è¿”å›é¡¹ç›®æ ¹ç›®å½•](../CLAUDE.md) | ğŸ“„ [Bash æ¨¡å—æ–‡æ¡£](../bash-permission-hook/CLAUDE.md)